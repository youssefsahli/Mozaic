<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mozaic</title>
    <style>
      /* ── CSS Variables ────────────────────────── */
      :root {
        --bg:         #0c0c0c;
        --surface:    #141414;
        --surface-2:  #1a1a1a;
        --surface-3:  #212121;
        --border:     #232323;
        --border-hi:  #383838;
        --text:       #ccc;
        --text-dim:   #5a5a5a;
        --accent:     #5b9;
        --accent-bg:  rgba(85,187,153,.12);
        --accent-hover: #6dc9a0;
        --danger:     #d16969;
        --success:    #6a9955;
        --warning:    #e5c07b;
        --info:       #56b6c2;
        --radius:     4px;
        --radius-lg:  6px;
        --font-mono:  ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
        --header-h:   34px;
        --tab-h:      28px;
        --handle-w:   5px;
        --ease:       200ms cubic-bezier(0.4,0,0.2,1);
        --shadow-sm:  0 1px 2px rgba(0,0,0,.3);
        --shadow-md:  0 2px 8px rgba(0,0,0,.4);
      }

      /* ── Reset ────────────────────────────────── */
      *, *::before, *::after { margin:0; padding:0; box-sizing:border-box }

      body {
        background: var(--bg);
        color: var(--text);
        font: 12px/1.4 var(--font-mono);
        height: 100dvh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* ── Header ───────────────────────────────── */
      #mozaic-header {
        height: var(--header-h);
        min-height: var(--header-h);
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 10px;
        flex-shrink: 0;
      }
      #header-brand {
        display: flex;
        align-items: center;
        gap: 7px;
        color: var(--accent);
        font-weight: bold;
        letter-spacing: .04em;
        white-space: nowrap;
        flex-shrink: 0;
      }
      #header-logo { font-size: 15px }
      #header-title { font-size: 12px; text-transform: uppercase; letter-spacing: .1em }
      #header-divider {
        width: 1px;
        height: 20px;
        background: var(--border-hi);
        flex-shrink: 0;
      }
      #header-actions {
        display: flex;
        align-items: center;
        gap: 4px;
        flex: 1;
        flex-wrap: wrap;
      }
      .header-sep {
        width: 1px;
        height: 16px;
        background: var(--border-hi);
        flex-shrink: 0;
        margin: 0 4px;
      }

      /* ── Workspace (split layout) ──────────────── */
      #mozaic-app {
        display: flex;
        flex-direction: column;
        flex: 1;
        overflow: hidden;
      }
      #mozaic-workspace {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* ── Canvas area (left) ────────────────────── */
      #canvas-area {
        flex: 3 1 0%;
        min-width: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background: var(--bg);
        padding: 8px;
      }
      #mozaic-canvas {
        max-width: 100%;
        max-height: 100%;
      }

      /* ── Split handle ──────────────────────────── */
      #split-handle {
        width: var(--handle-w);
        background: var(--border);
        cursor: col-resize;
        flex-shrink: 0;
        transition: background 120ms;
        position: relative;
      }
      #split-handle:hover,
      #split-handle.is-dragging {
        background: var(--accent);
      }
      #split-handle::before {
        content: '';
        position: absolute;
        inset: 0 -4px;
      }

      /* ── Side panel (right) ────────────────────── */
      #side-panel {
        flex: 2 1 0%;
        min-width: 280px;
        display: flex;
        flex-direction: column;
        background: var(--surface);
        border-left: 1px solid var(--border);
        overflow: hidden;
      }

      /* ── Tab bar ───────────────────────────────── */
      #tab-bar {
        display: flex;
        align-items: stretch;
        height: var(--tab-h);
        min-height: var(--tab-h);
        background: var(--surface-2);
        border-bottom: 1px solid var(--border);
        gap: 0;
        flex-shrink: 0;
      }
      .tab-btn {
        flex: 1;
        padding: 0 12px;
        background: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        color: var(--text-dim);
        font: 11px/1 var(--font-mono);
        text-transform: uppercase;
        letter-spacing: .06em;
        cursor: pointer;
        transition: color var(--ease), border-color var(--ease), background var(--ease);
        white-space: nowrap;
      }
      .tab-btn:hover {
        color: var(--text);
        background: rgba(255,255,255,.03);
      }
      .tab-btn.is-active {
        color: var(--accent) !important;
        border-bottom-color: var(--accent) !important;
        background: var(--accent-bg) !important;
      }
      .tab-btn[hidden] { display: none }

      /* ── Tab content ───────────────────────────── */
      #tab-content {
        flex: 1;
        overflow: hidden;
        position: relative;
      }
      .tab-pane {
        position: absolute;
        inset: 0;
        display: none;
        flex-direction: column;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 6px;
        gap: 6px;
      }
      .tab-pane.is-active {
        display: flex;
      }

      /* ── Section label ────────────────────────── */
      .section-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .06em;
        color: var(--text-dim);
      }

      /* ── Shared button ────────────────────────── */
      button:not(.tab-btn), .btn {
        font: inherit;
        padding: 3px 8px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: var(--radius);
        cursor: pointer;
        transition: background 80ms, border-color 80ms;
        white-space: nowrap;
        line-height: 1.5;
      }
      button:not(.tab-btn):hover  { background: #222; border-color: var(--border-hi) }
      button:not(.tab-btn):active { background: #282828 }
      button:not(.tab-btn):disabled { opacity: .35; cursor: default; pointer-events: none }
      .is-active:not(.tab-btn) {
        background: var(--accent-bg) !important;
        border-color: var(--accent) !important;
        color: var(--accent) !important;
      }

      /* ── Button row ───────────────────────────── */
      .btn-row { display: flex; gap: 4px; flex-wrap: wrap }

      /* ── Script editor ────────────────────────── */
      #msc-editor-wrap {
        position: relative;
        flex: 1;
        min-height: 140px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
      }
      #msc-highlight, #msc-editor {
        position: absolute; top: 0; right: 0; bottom: 0; left: 36px;
        margin: 0; border: 0;
        padding: 6px 8px;
        font: 12px/1.45 var(--font-mono);
        white-space: pre; overflow: auto;
      }
      #msc-highlight { pointer-events: none; color: #ddd }
      #msc-editor {
        resize: none;
        background: transparent;
        color: transparent;
        caret-color: #eee;
      }
      #msc-editor:focus {
        outline: none;
        box-shadow: inset 0 0 0 1px var(--accent);
      }
      #msc-editor::selection {
        background: rgba(85,187,153,.25);
      }
      #msc-highlight::selection,
      #msc-highlight *::selection {
        background: transparent;
      }
      #msc-status {
        min-height: 14px;
        font-size: 11px;
        color: var(--text-dim);
        flex-shrink: 0;
      }

      /* ── Pixel editor controls ────────────────── */
      #pixel-controls { display: flex; flex-direction: column; gap: 4px; flex-shrink: 0 }
      .pixel-row { display: flex; align-items: center; gap: 4px; flex-wrap: wrap }
      .pixel-row input[type=number] {
        width: 48px; padding: 2px 4px;
        background: var(--bg); border: 1px solid var(--border);
        color: var(--text); border-radius: var(--radius); font: inherit;
      }
      .pixel-row input[type=color] {
        width: 22px; height: 22px; padding: 0;
        border: 1px solid var(--border); border-radius: var(--radius);
        background: none; cursor: pointer;
      }
      .pixel-row label { color: var(--text-dim); cursor: pointer; user-select: none }

      /* ── Pixel toolbox (vertical icon bar) ────── */
      #pixel-workspace {
        display: flex;
        gap: 4px;
        flex: 1;
        min-height: 0;
        overflow: hidden;
      }
      #pixel-toolbox {
        display: flex;
        flex-direction: column;
        gap: 2px;
        flex-shrink: 0;
      }
      .tool-btn {
        width: 26px !important;
        height: 26px !important;
        min-width: 26px !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        line-height: 1;
      }
      .toolbox-sep {
        width: 18px;
        height: 1px;
        background: var(--border);
        margin: 3px auto;
      }

      /* ── Palette ──────────────────────────────── */
      #palette-swatches { display: flex; gap: 3px; flex-wrap: wrap }
      .palette-swatch {
        width: 16px; height: 16px;
        border: 1px solid var(--border); border-radius: 2px;
        cursor: pointer; transition: border-color 80ms;
        position: relative;
        overflow: visible;
      }
      .palette-swatch:hover { border-color: var(--text-dim) }
      .palette-swatch.is-active { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent) }
      .palette-swatch.is-locked::after {
        content: ''; position: absolute; inset: 0;
        border: 1px solid rgba(255,255,255,.5);
        border-radius: 1px; pointer-events: none;
      }
      .palette-swatch .lock-indicator {
        position: absolute; bottom: -2px; right: -2px;
        font-size: 7px; line-height: 1; pointer-events: none;
      }
      .palette-swatch .msc-indicator {
        position: absolute; top: -2px; right: -2px;
        width: 4px; height: 4px; border-radius: 50%;
        background: var(--accent); pointer-events: none;
      }
      .palette-swatch .swatch-name {
        position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
        font-size: 7px; white-space: nowrap; pointer-events: none;
        color: var(--text); background: var(--surface-3);
        padding: 1px 3px; border-radius: 2px;
        opacity: 0; transition: opacity 80ms;
        z-index: 10;
      }
      .palette-swatch:hover .swatch-name { opacity: 1 }
      #palette-preset-select {
        padding: 2px 4px; font: inherit;
        background: var(--surface-2); border: 1px solid var(--border);
        color: var(--text); border-radius: var(--radius); cursor: pointer;
      }

      /* ── Named color chips (script editor palette bar) ── */
      #palette-color-chips {
        display: flex; gap: 3px; flex-wrap: wrap;
        flex-shrink: 0; min-height: 0;
      }
      .palette-chip {
        display: inline-flex; align-items: center; gap: 4px;
        padding: 2px 6px 2px 4px;
        border: 1px solid var(--border); border-radius: var(--radius);
        background: var(--surface-2); cursor: pointer;
        transition: border-color 80ms, background 80ms;
        font-size: 10px; color: var(--text);
      }
      .palette-chip:hover { border-color: var(--border-hi); background: #222 }
      .palette-chip-swatch {
        width: 10px; height: 10px; border-radius: 2px;
        border: 1px solid rgba(255,255,255,.15); flex-shrink: 0;
      }
      #palette-chips-label {
        font-size: 9px; color: var(--text-dim);
        text-transform: uppercase; letter-spacing: .04em;
        flex-shrink: 0; align-self: center;
      }

      /* ── Editor File Tabs ───────────────────────── */
      #editor-tabs {
        display: flex;
        align-items: stretch;
        overflow-x: auto;
        overflow-y: hidden;
        flex-shrink: 0;
        background: var(--bg);
        border-bottom: 1px solid var(--border);
        min-height: 0;
        scrollbar-width: none;
      }
      #editor-tabs:empty { display: none }
      #editor-tabs::-webkit-scrollbar { display: none }
      .editor-tab {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0 4px 0 10px;
        height: 28px;
        border-right: 1px solid var(--border);
        cursor: pointer;
        white-space: nowrap;
        flex-shrink: 0;
        font-size: 11px;
        color: var(--text-dim);
        background: var(--surface-2);
        transition: color 80ms, background 80ms;
        user-select: none;
        max-width: 180px;
        min-width: 60px;
        position: relative;
      }
      .editor-tab:hover { background: var(--surface-3); color: var(--text) }
      .editor-tab.is-active {
        background: var(--surface) !important;
        color: var(--text) !important;
        border-top: 2px solid var(--accent);
      }
      .editor-tab.is-active::after {
        content: '';
        position: absolute;
        bottom: -1px; left: 0; right: 0;
        height: 1px;
        background: var(--surface);
      }
      .editor-tab-label {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        min-width: 0;
      }
      .editor-tab-close {
        width: 16px; height: 16px;
        flex-shrink: 0;
        display: flex; align-items: center; justify-content: center;
        border: none !important;
        background: transparent !important;
        color: var(--text-dim) !important;
        padding: 0 !important;
        font-size: 14px !important;
        line-height: 1;
        min-width: 16px !important;
        cursor: pointer !important;
        border-radius: 3px !important;
        opacity: 0;
        transition: opacity 80ms, background 80ms, color 80ms;
      }
      .editor-tab:hover .editor-tab-close,
      .editor-tab.is-active .editor-tab-close { opacity: .6 }
      .editor-tab-close:hover {
        opacity: 1 !important;
        background: rgba(255,255,255,.1) !important;
        color: var(--text) !important;
      }

      /* ── Autocomplete dropdown ──────────── */
      #msc-autocomplete {
        position: fixed;
        display: none;
        z-index: 1000;
        min-width: 160px;
        max-height: 180px;
        overflow-y: auto;
        background: var(--surface-2);
        border: 1px solid var(--border-hi);
        border-radius: var(--radius);
        box-shadow: var(--shadow-md);
        padding: 2px;
        font: 11px/1.4 var(--font-mono);
      }
      #msc-autocomplete.is-open { display: block }
      .autocomplete-item {
        padding: 4px 8px;
        cursor: pointer;
        border-radius: 2px;
        color: var(--text);
        white-space: nowrap;
      }
      .autocomplete-item:hover,
      .autocomplete-item.is-selected {
        background: var(--accent-bg);
        color: var(--accent);
      }
      .autocomplete-hint {
        font-size: 9px;
        color: var(--text-dim);
        margin-left: 6px;
      }

      /* ── Used colors bar (text editor) ── */
      #editor-used-colors {
        display: flex;
        gap: 2px;
        flex-wrap: wrap;
        flex-shrink: 0;
        min-height: 0;
        padding: 2px 0;
      }
      .editor-color-swatch {
        width: 16px;
        height: 16px;
        border: 1px solid var(--border);
        border-radius: 2px;
        cursor: pointer;
        transition: border-color 80ms, transform 80ms;
        padding: 0;
        background: none;
      }
      .editor-color-swatch:hover {
        border-color: var(--accent);
        transform: scale(1.2);
        z-index: 2;
      }

      /* ── Toggle chips ─────────────────────────── */
      .chip-row { display: flex; gap: 3px; flex-wrap: wrap }
      .chip-row label {
        display: inline-flex; align-items: center; gap: 3px;
        padding: 2px 6px;
        background: var(--surface-2); border: 1px solid var(--border);
        border-radius: var(--radius); cursor: pointer;
        transition: background 80ms, border-color 80ms;
        user-select: none;
      }
      .chip-row label:hover { border-color: var(--border-hi) }
      .chip-row input[type=checkbox] { display: none }
      .chip-row input[type=radio] { display: none }
      .chip-row input[type=checkbox]:checked+span { color: var(--accent) }
      .chip-row input[type=radio]:checked+span { color: var(--accent) }
      .chip-row label:has(input:checked) {
        background: var(--accent-bg); border-color: var(--accent);
      }

      /* ── Pixel canvas area ────────────────────── */
      #pixel-editor-wrap {
        flex: 1;
        min-width: 0;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--bg);
        overflow: hidden;
        position: relative;
        touch-action: none;
      }
      #pixel-stage  { position: relative; width: 100%; height: 100%; touch-action: none }
      #pixel-editor { image-rendering: pixelated; background: transparent; border: 0 }
      #pixel-grid-overlay {
        position: absolute; inset: 0;
        pointer-events: none; image-rendering: pixelated;
      }
      #pixel-footer {
        font-size: 10px; color: var(--text-dim);
        display: flex; justify-content: space-between;
        flex-shrink: 0;
      }

      /* ── Pixel bottom bar (modern zoom & size) ── */
      #pixel-bottom-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 16px;
        padding: 8px 12px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: 6px;
        flex-shrink: 0;
      }
      .bar-group {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .bar-group label {
        color: var(--text-dim);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .04em;
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
      }
      .bar-group input[type=range] {
        -webkit-appearance: none;
        appearance: none;
        width: 80px;
        height: 4px;
        background: var(--border-hi);
        border-radius: 2px;
        outline: none;
        cursor: pointer;
      }
      .bar-group input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--accent);
        border: none;
        cursor: pointer;
        transition: transform 80ms;
      }
      .bar-group input[type=range]::-webkit-slider-thumb:hover {
        transform: scale(1.2);
      }
      .bar-group input[type=range]::-moz-range-thumb {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--accent);
        border: none;
        cursor: pointer;
      }
      .bar-group span {
        min-width: 24px;
        color: var(--text-dim);
        font-size: 11px;
      }
      .bar-divider {
        width: 1px;
        height: 16px;
        background: var(--border-hi);
        flex-shrink: 0;
      }

      /* ── Docs ──────────────────────────────────── */
      #docs-search {
        width: 100%; padding: 6px 8px;
        border-radius: var(--radius);
        background: var(--bg); border: 1px solid var(--border);
        color: var(--text); font: inherit;
        flex-shrink: 0;
      }
      #docs-search::placeholder { color: var(--text-dim) }
      #docs-results {
        display: flex; flex-direction: column; gap: 3px;
        max-height: 180px; overflow: auto;
        flex-shrink: 0;
        padding-right: 1px;
      }
      .doc-item {
        text-align: left;
        background: var(--surface-2); border: 1px solid var(--border);
        color: var(--text); border-radius: var(--radius);
        padding: 6px 8px; cursor: pointer;
        transition: border-color 80ms; font: inherit;
      }
      .doc-item:hover { border-color: var(--border-hi) }
      .doc-item small {
        display: block;
        color: var(--text-dim);
        margin-top: 3px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .05em;
      }
      .doc-item.is-active { border-color: var(--accent); background: var(--accent-bg) }
      #docs-content {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 8px;
        background: var(--bg);
        font-size: 11px; line-height: 1.55;
        color: var(--text);
        overflow: auto;
        flex: 1;
      }
      .docs-empty {
        color: var(--text-dim);
      }
      .docs-outline {
        border: 1px solid var(--border);
        background: var(--surface-2);
        border-radius: var(--radius);
        padding: 6px 8px;
        margin-bottom: 8px;
      }
      .docs-outline-title {
        color: var(--text-dim);
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .06em;
        margin-bottom: 4px;
      }
      .docs-outline-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 3px;
      }
      .docs-outline-list a {
        color: var(--text);
        text-decoration: none;
      }
      .docs-outline-list a:hover {
        color: var(--accent);
      }
      .docs-article {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .docs-article-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .docs-article-title {
        font-size: 13px;
        color: var(--text);
      }
      .docs-badge {
        border: 1px solid var(--accent);
        color: var(--accent);
        background: var(--accent-bg);
        border-radius: var(--radius);
        font-size: 10px;
        padding: 1px 6px;
        text-transform: uppercase;
        letter-spacing: .06em;
        white-space: nowrap;
      }
      .docs-section-title {
        margin-top: 2px;
        font-size: 12px;
        color: var(--accent);
      }
      .docs-subsection-title {
        margin-top: 2px;
        font-size: 11px;
        color: var(--text);
      }
      .docs-paragraph {
        color: var(--text);
      }
      .docs-list {
        padding-left: 16px;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .docs-list li {
        color: var(--text);
      }
      .docs-code {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 6px;
        background: var(--surface-2);
        white-space: pre-wrap;
        overflow-wrap: anywhere;
      }

      /* ── Canvas ───────────────────────────────── */
      canvas { display: block; border: 1px solid var(--border); image-rendering: pixelated }

      /* ── Syntax highlighting ──────────────────── */
      .msc-keyword { color: #56b6c2 }
      .msc-string  { color: #98c379 }
      .msc-comment { color: #6a9955 }
      .msc-symbol  { color: #e5c07b }

      /* ── File Tree View ──────────────────────── */
      #file-tree-panel {
        display: flex;
        flex-direction: column;
        border-bottom: 1px solid var(--border);
        max-height: 240px;
        min-height: 0;
        overflow: hidden;
        flex-shrink: 0;
      }
      #file-tree-header {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: var(--surface-2);
        border-bottom: 1px solid var(--border);
        user-select: none;
        flex-shrink: 0;
      }
      #file-tree-header:hover { background: var(--surface-3) }
      #file-tree-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .06em;
        color: var(--text-dim);
        cursor: pointer;
        flex: 1;
      }
      #file-tree-toggle {
        font-size: 10px;
        color: var(--text-dim);
        transition: transform 120ms;
        cursor: pointer;
      }

      /* ── File tree action buttons ───────────── */
      .ftv-header-actions {
        display: flex;
        align-items: center;
        gap: 2px;
        flex-shrink: 0;
      }
      .ftv-header-btn {
        font: 11px/1 var(--font-mono) !important;
        width: 22px !important; height: 22px !important;
        min-width: 22px !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background: transparent !important;
        border: 1px solid transparent !important;
        color: var(--text-dim) !important;
        border-radius: 3px !important;
        cursor: pointer !important;
        transition: all 80ms !important;
      }
      .ftv-header-btn:hover {
        background: var(--surface-3) !important;
        border-color: var(--border) !important;
        color: var(--text) !important;
      }

      /* ── Header "New" dropdown menu ──────────── */
      .header-menu-anchor { position: relative; display: inline-block }
      .header-dropdown {
        position: absolute;
        top: 100%; left: 0;
        z-index: 100;
        min-width: 200px;
        background: var(--surface-2);
        border: 1px solid var(--border-hi);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        padding: 4px;
        display: none;
        flex-direction: column;
      }
      .header-dropdown.is-open { display: flex }
      .header-dropdown-row {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
      }
      .header-dropdown-label {
        font-size: 10px;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: .04em;
        white-space: nowrap;
      }
      .header-dropdown-select {
        flex: 1;
        padding: 2px 4px;
        font: 11px var(--font-mono);
        background: var(--surface-3);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: var(--radius);
        cursor: pointer;
      }

      /* ── Add-file dropdown menu ─────────────── */
      .ftv-menu-anchor { position: relative }
      .ftv-dropdown {
        position: absolute;
        top: 100%; right: 0;
        z-index: 100;
        min-width: 180px;
        background: var(--surface-2);
        border: 1px solid var(--border-hi);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        padding: 4px;
        display: none;
        flex-direction: column;
      }
      .ftv-dropdown.is-open { display: flex }
      .ftv-dropdown-item {
        font: 11px/1.2 var(--font-mono) !important;
        text-align: left !important;
        padding: 6px 10px !important;
        background: transparent !important;
        border: none !important;
        color: var(--text) !important;
        border-radius: 3px !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
        width: 100% !important;
        min-width: auto !important;
        transition: background 60ms !important;
      }
      .ftv-dropdown-item:hover {
        background: var(--accent-bg) !important;
        color: var(--accent) !important;
      }
      .ftv-dropdown-sep {
        height: 1px;
        background: var(--border);
        margin: 3px 6px;
      }
      .ftv-dropdown-icon {
        width: 14px; display: inline-flex;
        align-items: center; justify-content: center;
        flex-shrink: 0;
      }
      .ftv-dropdown-icon svg {
        width: 14px; height: 14px;
        fill: none; stroke: currentColor;
        stroke-width: 1.4; stroke-linecap: round; stroke-linejoin: round;
      }
      .ftv-dropdown-label { flex: 1 }
      .ftv-dropdown-hint {
        font-size: 9px;
        color: var(--text-dim);
        letter-spacing: .02em;
      }
      #file-tree-panel.is-collapsed #file-tree-toggle {
        transform: rotate(-90deg);
      }
      #file-tree-panel.is-collapsed #file-tree-container {
        display: none;
      }
      #file-tree-container {
        overflow-y: auto;
        overflow-x: hidden;
        flex: 1;
        padding: 2px 0;
      }

      /* Tree items */
      .ftv-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .ftv-nested {
        padding-left: 0;
      }
      .ftv-item {
        margin: 0;
        padding: 0;
      }
      .ftv-row {
        display: flex;
        align-items: center;
        gap: 3px;
        padding: 2px 6px 2px 4px;
        cursor: pointer;
        transition: background 60ms;
        white-space: nowrap;
        font-size: 11px;
        min-height: 22px;
      }
      .ftv-row:hover {
        background: rgba(255,255,255,.04);
      }
      .ftv-row.ftv-active {
        background: var(--accent-bg);
        color: var(--accent);
      }
      .ftv-chevron {
        width: 12px;
        font-size: 9px;
        color: var(--text-dim);
        text-align: center;
        flex-shrink: 0;
        cursor: pointer;
      }
      .ftv-chevron-spacer {
        width: 12px;
        flex-shrink: 0;
      }
      .ftv-icon {
        font-size: 11px;
        flex-shrink: 0;
        width: 16px;
        text-align: center;
      }
      .ftv-label {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--text);
      }
      .ftv-row.ftv-active .ftv-label {
        color: var(--accent);
      }
      .ftv-actions {
        display: none;
        gap: 2px;
        margin-left: auto;
        flex-shrink: 0;
      }
      .ftv-row:hover .ftv-actions {
        display: flex;
      }
      .ftv-action-btn {
        background: none !important;
        border: none !important;
        padding: 0 2px !important;
        font-size: 10px;
        color: var(--text-dim);
        cursor: pointer;
        line-height: 1;
        min-width: auto !important;
        min-height: auto !important;
      }
      .ftv-action-btn:hover {
        color: var(--accent) !important;
        background: none !important;
      }
      .ftv-rename-input {
        flex: 1;
        font: 11px/1 var(--font-mono);
        background: var(--bg);
        border: 1px solid var(--accent);
        color: var(--text);
        padding: 1px 4px;
        border-radius: 2px;
        outline: none;
      }

      /* ── Scrollbar ────────────────────────────── */
      ::-webkit-scrollbar { width: 4px; height: 4px }
      ::-webkit-scrollbar-track { background: transparent }
      ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 2px }
      ::-webkit-scrollbar-thumb:hover { background: #333 }

      /* ── Editor Toolbar ────────────────────────── */
      .editor-toolbar {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        flex-shrink: 0;
        min-height: 32px;
      }
      .editor-toolbar-icon {
        font-size: 13px;
        color: var(--accent);
        flex-shrink: 0;
        display: flex;
        align-items: center;
      }
      .editor-toolbar-icon svg {
        width: 14px; height: 14px;
        fill: none; stroke: var(--accent);
        stroke-width: 1.5;
      }
      .editor-toolbar-name {
        font-size: 11px;
        color: var(--text);
        font-weight: 600;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .editor-toolbar-dot {
        color: var(--warning);
        font-size: 16px;
        line-height: 1;
        flex-shrink: 0;
        animation: pulse-dot 2s ease-in-out infinite;
      }
      @keyframes pulse-dot { 0%,100%{opacity:1} 50%{opacity:.3} }
      .editor-toolbar-badge {
        font-size: 9px;
        color: var(--text-dim);
        background: var(--surface-3);
        padding: 2px 6px;
        border-radius: 3px;
        flex-shrink: 0;
        letter-spacing: .04em;
        text-transform: uppercase;
      }
      .editor-toolbar-spacer { flex: 1 }
      .toolbar-btn {
        font: 11px/1.2 var(--font-mono) !important;
        padding: 3px 10px !important;
        background: var(--surface-3) !important;
        border: 1px solid var(--border) !important;
        color: var(--text-dim) !important;
        border-radius: var(--radius) !important;
        cursor: pointer !important;
        transition: all 80ms !important;
        display: inline-flex !important;
        align-items: center !important;
        gap: 4px !important;
        min-width: auto !important;
        width: auto !important;
        height: auto !important;
      }
      .toolbar-btn:hover {
        color: var(--text) !important;
        border-color: var(--border-hi) !important;
        background: #282828 !important;
      }
      .toolbar-btn-accent {
        background: var(--accent-bg) !important;
        border-color: rgba(85,187,153,.3) !important;
        color: var(--accent) !important;
      }
      .toolbar-btn-accent:hover {
        background: rgba(85,187,153,.2) !important;
        border-color: var(--accent) !important;
      }

      /* ── Line Numbers ──────────────────────────── */
      #line-numbers {
        position: absolute;
        left: 0; top: 0; bottom: 0;
        width: 36px;
        padding: 6px 6px 6px 2px;
        background: rgba(18,18,18,.8);
        border-right: 1px solid var(--border);
        color: #3a3a3a;
        font: 12px/1.45 var(--font-mono);
        text-align: right;
        white-space: pre;
        overflow-y: hidden;
        user-select: none;
        pointer-events: none;
        z-index: 1;
      }

      /* ── Header improvements ───────────────────── */
      .header-btn-primary {
        background: var(--accent) !important;
        color: var(--bg) !important;
        border-color: var(--accent) !important;
        font-weight: 600;
      }
      .header-btn-primary:hover {
        background: var(--accent-hover) !important;
        border-color: var(--accent-hover) !important;
      }
      .header-file-info {
        font-size: 11px;
        color: var(--text-dim);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 200px;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .header-file-dot {
        width: 6px; height: 6px;
        border-radius: 50%;
        background: var(--success);
        flex-shrink: 0;
        display: inline-block;
      }

      /* ── Status Bar ────────────────────────────── */
      #status-bar {
        height: 24px; min-height: 24px;
        display: flex; align-items: center;
        padding: 0 12px;
        background: var(--surface);
        border-top: 1px solid var(--border);
        font-size: 10px; color: var(--text-dim);
        gap: 16px; flex-shrink: 0;
      }
      .status-item { display: flex; align-items: center; gap: 4px; white-space: nowrap }
      .status-spacer { flex: 1 }
      .status-accent { color: var(--accent) }

      /* ── File Tree polish ─────────────────────── */
      .ftv-icon { display: flex; align-items: center; justify-content: center }
      .ftv-icon svg {
        width: 14px; height: 14px;
        fill: none; stroke: currentColor;
        stroke-width: 1.4; stroke-linecap: round; stroke-linejoin: round;
      }
      .ftv-folder-icon { color: var(--accent) }
      .ftv-script-icon { color: var(--info) }
      .ftv-image-icon { color: #c586c0 }
      .ftv-row { gap: 4px; padding: 3px 8px 3px 4px; min-height: 24px; border-radius: 3px; margin: 0 4px }
      .ftv-row:hover { background: rgba(255,255,255,.05) }
      .ftv-action-btn { padding: 1px 4px !important; font-size: 11px; border-radius: 3px !important; opacity: .7; transition: all 80ms }
      .ftv-action-btn:hover { background: var(--accent-bg) !important; opacity: 1 }

      /* ── Pixel Editor — Modern UI ────────── */
      .tool-btn {
        width: 30px !important; height: 30px !important; min-width: 30px !important;
        border-radius: var(--radius) !important;
        transition: all 100ms ease;
        font-size: 14px;
      }
      .tool-btn:hover {
        background: var(--surface-3) !important;
        border-color: var(--border-hi) !important;
        transform: translateY(-1px);
      }
      .tool-btn.is-active {
        box-shadow: 0 0 0 1.5px var(--accent), var(--shadow-sm);
        background: var(--accent-bg) !important;
        border-color: var(--accent) !important;
      }
      .toolbox-sep { width: 22px; margin: 6px auto; background: var(--border); opacity: .5 }
      #pixel-toolbox {
        padding: 6px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
      }
      #pixel-editor-wrap {
        border-radius: var(--radius-lg);
        background: #080808;
        box-shadow: inset 0 2px 8px rgba(0,0,0,.4), 0 1px 3px rgba(0,0,0,.2);
      }
      #pixel-bottom-bar {
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
      }
      #palette-swatches {
        padding: 5px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        min-height: 26px;
        box-shadow: inset 0 1px 2px rgba(0,0,0,.15);
      }
      .palette-swatch {
        width: 20px; height: 20px;
        border-color: rgba(255,255,255,.08);
        border-radius: 3px;
        transition: border-color 100ms, transform 100ms, box-shadow 100ms;
      }
      .palette-swatch:hover {
        transform: scale(1.2); z-index: 2;
        box-shadow: 0 2px 6px rgba(0,0,0,.3);
      }
      .palette-swatch.is-active {
        box-shadow: 0 0 0 2px var(--accent), 0 2px 6px rgba(85,187,153,.2);
        transform: scale(1.2); z-index: 2;
      }
      #msc-editor-wrap { border-radius: var(--radius-lg) }
      #pixel-controls {
        background: var(--surface);
        border-radius: var(--radius);
        padding: 6px;
      }
      #pixel-footer {
        padding: 4px 6px;
        background: rgba(20,20,20,.5);
        border-radius: var(--radius);
      }
      .tool-btn svg {
        width: 16px; height: 16px;
        fill: none; stroke: currentColor;
        stroke-width: 1.3; stroke-linecap: round; stroke-linejoin: round;
      }
      .tool-btn.is-active svg { stroke: var(--accent) }
    </style>
  </head>
  <body>
    <div id="mozaic-app">

      <!-- ── Header ───────────────────────────────── -->
      <header id="mozaic-header">
        <div id="header-brand">
          <span id="header-logo">&#9672;</span>
          <span id="header-title">Mozaic</span>
        </div>
        <div id="header-divider"></div>
        <div id="header-actions">
          <div class="header-menu-anchor">
            <button id="new-rom-button" type="button" title="Create new ROM">+ New</button>
            <div id="new-rom-menu" class="header-dropdown">
              <div class="header-dropdown-row">
                <label class="header-dropdown-label">Palette:</label>
                <select id="new-rom-palette" class="header-dropdown-select"></select>
              </div>
              <div class="ftv-dropdown-sep"></div>
              <button type="button" class="ftv-dropdown-item" data-new-rom="empty">
                <span class="ftv-dropdown-label">Empty ROM</span>
                <span class="ftv-dropdown-hint">Blank</span>
              </button>
              <button type="button" class="ftv-dropdown-item" data-new-rom="amiga">
                <span class="ftv-dropdown-label">Amiga Demo</span>
                <span class="ftv-dropdown-hint">Classic</span>
              </button>
              <button type="button" class="ftv-dropdown-item" data-new-rom="checkerboard">
                <span class="ftv-dropdown-label">Checkerboard</span>
                <span class="ftv-dropdown-hint">Pattern</span>
              </button>
            </div>
          </div>
          <button id="open-rom-button" type="button" title="Open ROM image">Open ROM</button>
          <button id="open-script-button" type="button" title="Import script file">&#8593; Import</button>
          <div class="header-sep"></div>
          <button id="save-rom-button" type="button" title="Export ROM as PNG">&#8595; Export ROM</button>
          <button id="open-config-button" type="button" title="Edit engine config">&#9881; Config</button>
          <button id="reload-config-button" type="button" title="Reload config">&#8635;</button>
          <div class="header-sep"></div>
          <button id="restart-button" type="button" title="Run game" class="header-btn-primary">&#9654; Run</button>
          <div class="header-sep"></div>
          <span id="header-file-info" class="header-file-info"></span>
        </div>
      </header>

      <!-- ── Workspace (split layout) ────────────── -->
      <div id="mozaic-workspace">

        <!-- LEFT: Game canvas ────────────────────── -->
        <main id="canvas-area">
          <canvas id="mozaic-canvas"></canvas>
        </main>

        <!-- SPLIT HANDLE ─────────────────────────── -->
        <div id="split-handle"></div>

        <!-- RIGHT: Tabbed side panel ─────────────── -->
        <div id="side-panel">

          <!-- File tree panel -->
          <div id="file-tree-panel">
            <div id="file-tree-header">
              <span id="file-tree-title">Files</span>
              <div class="ftv-header-actions">
                <div class="ftv-menu-anchor">
                  <button id="ftv-add-btn" type="button" class="ftv-header-btn" title="Add file">+</button>
                  <div id="ftv-add-menu" class="ftv-dropdown">
                    <button type="button" class="ftv-dropdown-item" data-action="new-script">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M4 1.5h5.5l3 3V14H4z"/><path d="M9.5 1.5v3h3"/></svg></span>
                      <span class="ftv-dropdown-label">New Script</span>
                      <span class="ftv-dropdown-hint">.msc</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-mzk">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M4 1.5h5.5l3 3V14H4z"/><path d="M9.5 1.5v3h3"/><text x="8" y="12" text-anchor="middle" font-size="8" fill="currentColor">M</text></svg></span>
                      <span class="ftv-dropdown-label">New MZK Asset</span>
                      <span class="ftv-dropdown-hint">.mzk</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-text">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M4 1.5h8V14H4z"/><line x1="6" y1="5" x2="10" y2="5"/><line x1="6" y1="7.5" x2="10" y2="7.5"/><line x1="6" y1="10" x2="9" y2="10"/></svg></span>
                      <span class="ftv-dropdown-label">New Text File</span>
                      <span class="ftv-dropdown-hint">.txt</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-json">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M5 2.5C3.5 2.5 3 3.5 3 4.5v2c0 .8-.5 1.5-1 1.5.5 0 1 .7 1 1.5v2c0 1 .5 2 2 2"/><path d="M11 2.5c1.5 0 2 1 2 2v2c0 .8.5 1.5 1 1.5-.5 0-1 .7-1 1.5v2c0 1-.5 2-2 2"/></svg></span>
                      <span class="ftv-dropdown-label">New JSON File</span>
                      <span class="ftv-dropdown-hint">.json</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-markdown">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><rect x="1.5" y="3" width="13" height="10" rx="1.5"/><path d="M4 10V6l2 2.5L8 6v4"/><path d="M11 8.5l1.5-1.5L14 8.5"/></svg></span>
                      <span class="ftv-dropdown-label">New Markdown</span>
                      <span class="ftv-dropdown-hint">.md</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-image">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><rect x="2" y="2" width="12" height="12" rx="1.5"/></svg></span>
                      <span class="ftv-dropdown-label">New Image</span>
                      <span class="ftv-dropdown-hint">64×64</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="new-folder">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M1.5 4h5l1.5-1.5H14v10H1.5z"/></svg></span>
                      <span class="ftv-dropdown-label">New Folder</span>
                    </button>
                    <div class="ftv-dropdown-sep"></div>
                    <button type="button" class="ftv-dropdown-item" data-action="import-script">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M8 2v9m0 0l-3-3m3 3l3-3M3 13h10"/></svg></span>
                      <span class="ftv-dropdown-label">Import Script…</span>
                      <span class="ftv-dropdown-hint">.msc .txt .json .md</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="import-image">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M8 2v9m0 0l-3-3m3 3l3-3M3 13h10"/></svg></span>
                      <span class="ftv-dropdown-label">Import Image…</span>
                      <span class="ftv-dropdown-hint">.png .jpg</span>
                    </button>
                    <button type="button" class="ftv-dropdown-item" data-action="import-rom">
                      <span class="ftv-dropdown-icon"><svg viewBox="0 0 16 16"><path d="M8 2v9m0 0l-3-3m3 3l3-3M3 13h10"/></svg></span>
                      <span class="ftv-dropdown-label">Import ROM…</span>
                      <span class="ftv-dropdown-hint">.mzk .png</span>
                    </button>
                  </div>
                </div>
              </div>
              <span id="file-tree-toggle" style="cursor:pointer">▾</span>
            </div>
            <div id="file-tree-container"></div>
          </div>

          <!-- Tab bar -->
          <div id="tab-bar">
            <button class="tab-btn is-active" data-tab="script" type="button">&#9998; Script</button>
            <button class="tab-btn" data-tab="pixel" type="button">&#9638; Pixel</button>
            <button class="tab-btn" data-tab="debug" type="button">&#9670; Debug</button>
            <button class="tab-btn" id="toggle-docs-button" data-tab="docs" type="button">&#9776; Docs</button>
          </div>

          <!-- Tab content -->
          <div id="tab-content">

            <!-- Tab: Script Editor ─────────────────── -->
            <section class="tab-pane is-active" id="msc-section">
              <div id="editor-tabs" role="tablist" aria-label="Open editor files"></div>
              <div class="editor-toolbar">
                <span class="editor-toolbar-icon" id="editor-file-icon"><svg viewBox="0 0 16 16"><path d="M4 2h6l3 3v9H4z" fill="none" stroke="currentColor" stroke-width="1.3"/><path d="M10 2v3h3" fill="none" stroke="currentColor" stroke-width="1.3"/></svg></span>
                <span class="editor-toolbar-name" id="editor-file-name">untitled.msc</span>
                <span class="editor-toolbar-dot" id="editor-modified-dot" hidden>&#9679;</span>
                <span class="editor-toolbar-badge" id="text-editor-title">Script</span>
                <span class="editor-toolbar-spacer"></span>
                <button id="save-file-button" type="button" class="toolbar-btn toolbar-btn-accent" title="Save (Ctrl+S)">&#10003; Save</button>
                <button id="download-file-button" type="button" class="toolbar-btn" title="Download file">&#8595;</button>
              </div>
              <div id="palette-color-chips" aria-label="Named palette colors — click to insert into script"></div>
              <div id="editor-used-colors" aria-label="Palette colors — click to insert hex"></div>
              <div id="msc-editor-wrap">
                <div id="line-numbers" aria-hidden="true">1</div>
                <pre id="msc-highlight"></pre>
                <textarea id="msc-editor" spellcheck="false" aria-label="MSC editor"></textarea>
              </div>
              <div id="msc-status"></div>
            </section>

            <!-- Tab: Pixel Editor ──────────────────── -->
            <section class="tab-pane" id="pixel-section">
              <div class="editor-toolbar">
                <span class="editor-toolbar-icon"><svg viewBox="0 0 16 16"><rect x="2" y="2" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width="1.3"/><circle cx="5" cy="5.5" r="1.2" fill="currentColor" opacity=".4"/><path d="M2 11l3-3 2 2 3-4 4 5" fill="none" stroke="currentColor" stroke-width="1.3"/></svg></span>
                <span class="editor-toolbar-name" id="pixel-file-name">No image</span>
                <span class="editor-toolbar-badge" id="pixel-file-size"></span>
                <span class="editor-toolbar-spacer"></span>
                <button id="download-pixel-button" type="button" class="toolbar-btn" title="Download as PNG">&#8595; PNG</button>
              </div>
              <div id="pixel-controls">
                <div class="pixel-row">
                  <input id="pixel-color" type="color" value="#ff00ff" />
                  <button id="palette-add-button" type="button" title="Add to palette">+</button>
                  <button id="palette-update-button" type="button" title="Update active palette slot with current color (applies indexed swap)">&#8635; Update</button>
                  <select id="palette-preset-select" title="Palette presets">
                    <option value="">Preset...</option>
                  </select>
                  <button id="palette-import-button" type="button" title="Import palette">&#8593; Import</button>
                  <button id="palette-export-button" type="button" title="Export palette">&#8595; Export</button>
                </div>
                <div id="palette-swatches"></div>
              </div>
              <div class="chip-row">
                <label><input id="stylus-only-toggle" type="checkbox" /><span>Stylus Only</span></label>
                <label><input id="pressure-size-toggle" type="radio" name="pressure-mode" checked /><span>P:Size</span></label>
                <label><input id="pressure-dither-toggle" type="radio" name="pressure-mode" /><span>P:Dither</span></label>
              </div>
              <div id="pixel-workspace">
                <div id="pixel-toolbox">
                  <button id="preset-pencil-button" class="tool-btn" type="button" title="Pencil (B)"><svg viewBox="0 0 16 16"><path d="M2.5 13.5l1-4L11 2l2.5 2.5-7.5 7.5z"/><path d="M9 4l3 3"/></svg></button>
                  <button id="preset-brush-button" class="tool-btn" type="button" title="Brush (3px)"><svg viewBox="0 0 16 16"><path d="M10 1.5l4 4-6 6H4v-4z"/><path d="M3 12.5c-1 1-1.5 2-1 2.5s1.5 0 2.5-1"/></svg></button>
                  <button id="preset-eraser-button" class="tool-btn" type="button" title="Eraser (E)"><svg viewBox="0 0 16 16"><path d="M6 14h7M3.5 10l4-6.5 5 5-4 6.5z"/><path d="M3.5 10l5 5"/></svg></button>
                  <button id="eraser-toggle-button" class="tool-btn" type="button" title="Toggle eraser (E)"><svg viewBox="0 0 16 16"><path d="M6 14h7M3.5 10l4-6.5 5 5-4 6.5z"/><path d="M3.5 10l5 5"/></svg></button>
                  <button id="fill-tool-button" class="tool-btn" type="button" title="Fill (G)"><svg viewBox="0 0 16 16"><path d="M3 13l2-6 6-4 2 2-4 6z"/><path d="M12 9c1 1 2.5 3 2 4s-2-.5-2-2"/></svg></button>
                  <button id="select-tool-button" class="tool-btn" type="button" title="Select (M)"><svg viewBox="0 0 16 16"><rect x="2.5" y="2.5" width="11" height="11" rx=".5" stroke-dasharray="2 2"/></svg></button>
                  <button id="pipette-tool-button" class="tool-btn" type="button" title="Pipette (I)"><svg viewBox="0 0 16 16"><path d="M12 2l2 2-1.5 1.5-2-2z"/><path d="M10.5 5.5l-6 6L3 14l2.5-1.5 6-6z"/></svg></button>
                  <div class="toolbox-sep"></div>
                  <button id="entity-brush-button" class="tool-btn" type="button" title="Entity Brush (N)"><svg viewBox="0 0 16 16"><circle cx="8" cy="6" r="3"/><path d="M4 14c0-2.5 1.8-4 4-4s4 1.5 4 4"/></svg></button>
                  <button id="data-inspector-button" class="tool-btn" type="button" title="Data Inspector (D)"><svg viewBox="0 0 16 16"><circle cx="7" cy="7" r="4"/><path d="M10 10l3.5 3.5"/></svg></button>
                  <div class="toolbox-sep"></div>
                  <button id="undo-button" class="tool-btn" type="button" title="Undo (Ctrl+Z)"><svg viewBox="0 0 16 16"><path d="M4 7l-2.5-2.5L4 2"/><path d="M1.5 4.5H10a4 4 0 010 8H6"/></svg></button>
                  <button id="redo-button" class="tool-btn" type="button" title="Redo (Ctrl+Y)"><svg viewBox="0 0 16 16"><path d="M12 7l2.5-2.5L12 2"/><path d="M14.5 4.5H6a4 4 0 000 8h4"/></svg></button>
                  <button id="clear-button" class="tool-btn" type="button" title="Clear canvas"><svg viewBox="0 0 16 16"><path d="M3 4h10M6 4V3h4v1M4.5 4v8.5h7V4"/><line x1="7" y1="6.5" x2="7" y2="10.5"/><line x1="9" y1="6.5" x2="9" y2="10.5"/></svg></button>
                </div>
                <div id="pixel-editor-wrap">
                  <div id="pixel-stage">
                    <canvas id="pixel-editor" width="64" height="64"></canvas>
                    <canvas id="pixel-grid-overlay" width="64" height="64"></canvas>
                  </div>
                </div>
              </div>
              <div id="pixel-footer">
                <span>Alt+Click picks layer · Right-click to color pick · Scroll to zoom</span>
                <span id="pixel-coords">&ndash;, &ndash;</span>
              </div>
              <div id="pixel-bottom-bar">
                <div class="bar-group">
                  <label for="pixel-zoom">Zoom</label>
                  <input id="pixel-zoom" type="range" min="1" max="64" value="8" />
                  <span id="zoom-level">8&times;</span>
                </div>
                <div class="bar-divider"></div>
                <div class="bar-group">
                  <label for="brush-size">Size</label>
                  <input id="brush-size" type="range" min="1" max="9" value="1" />
                  <span id="brush-size-label">1</span>
                </div>
              </div>
            </section>

            <!-- Tab: Debug ─────────────────────────── -->
            <section class="tab-pane" id="pane-debug">
              <div class="section-label">Layers</div>
              <div class="chip-row">
                <label><input id="layer-static-toggle" type="radio" name="editor-layer" checked /><span>Static World</span></label>
                <label><input id="layer-ecs-toggle" type="radio" name="editor-layer" /><span>ECS Visualizer</span></label>
              </div>
              <div class="section-label">Grid</div>
              <div class="chip-row">
                <label><input id="grid-inline-toggle" type="checkbox" checked /><span>Grid</span></label>
                <label><input id="grid-custom-toggle" type="checkbox" /><span>Custom</span></label>
              </div>
              <div class="pixel-row">
                <label for="grid-size">Cell</label>
                <input id="grid-size" type="number" min="1" max="64" value="8" />
                <label for="grid-major">Major</label>
                <input id="grid-major" type="number" min="1" max="64" value="4" />
              </div>
              <div class="section-label">Overlays</div>
              <div class="chip-row">
                <label><input id="debug-collision-toggle" type="checkbox" /><span>Collision</span></label>
                <label><input id="debug-path-toggle" type="checkbox" /><span>Paths</span></label>
                <label><input id="debug-points-toggle" type="checkbox" /><span>Pts</span></label>
                <label><input id="debug-ids-toggle" type="checkbox" /><span>IDs</span></label>
              </div>
            </section>

            <!-- Tab: Docs ──────────────────────────── -->
            <section class="tab-pane" id="docs-pane">
              <input id="docs-search" type="text" placeholder="Search..." />
              <div id="docs-results"></div>
              <div id="docs-content">Select a document.</div>
            </section>

          </div><!-- #tab-content -->
        </div><!-- #side-panel -->

      </div><!-- #mozaic-workspace -->
      <div id="status-bar">
        <span class="status-item" id="status-file-info">Ready</span>
        <span class="status-spacer"></span>
        <span class="status-item" id="status-cursor-pos"></span>
        <span class="status-item">Mozaic Engine</span>
      </div>
    </div><!-- #mozaic-app -->
    <div id="msc-autocomplete" role="listbox" aria-label="Autocomplete suggestions"></div>
    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
