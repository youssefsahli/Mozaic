<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mozaic</title>
    <style>
      :root {
        --bg:        #0c0c0c;
        --surface:   #141414;
        --surface-2: #1a1a1a;
        --border:    #222;
        --border-hi: #333;
        --text:      #ccc;
        --text-dim:  #777;
        --accent:    #5b9;
        --accent-bg: rgba(85,187,153,.12);
        --radius:    5px;
        --font-mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      }
      *{margin:0;padding:0;box-sizing:border-box}
      body{
        background:var(--bg);
        color:var(--text);
        font:12px/1.4 var(--font-mono);
        display:flex;justify-content:center;
        min-height:100vh;
        padding:8px;
      }

      /* ── layout ───────────────────────────────── */
      #mozaic-app{
        display:grid;
        grid-template-columns:auto minmax(340px,420px);
        gap:10px;
        align-items:start;
        width:min(1400px,100%);
        padding:6px;
      }
      #mozaic-app.docs-open{
        grid-template-columns:auto minmax(320px,400px) minmax(240px,300px);
      }

      /* ── shared button ────────────────────────── */
      button,
      .btn{
        font:inherit;
        padding:3px 8px;
        background:var(--surface-2);
        border:1px solid var(--border);
        color:var(--text);
        border-radius:var(--radius);
        cursor:pointer;
        transition:background 80ms,border-color 80ms;
        white-space:nowrap;
        line-height:1.5;
      }
      button:hover{background:#222;border-color:var(--border-hi)}
      button:active{background:#282828}
      button:disabled{opacity:.35;cursor:default;pointer-events:none}
      .is-active{
        background:var(--accent-bg)!important;
        border-color:var(--accent)!important;
        color:var(--accent)!important;
      }

      /* ── toolbar ──────────────────────────────── */
      #tools-panel{display:flex;flex-direction:column;gap:6px;width:100%}
      .tool-row{display:flex;gap:4px;flex-wrap:wrap}

      /* ── card (sections) ──────────────────────── */
      .tool-section{
        background:var(--surface);
        border:1px solid var(--border);
        border-radius:var(--radius);
        padding:6px 8px;
      }
      .tool-title{
        font-size:10px;
        text-transform:uppercase;
        letter-spacing:.08em;
        color:var(--text-dim);
        margin-bottom:5px;
      }

      /* ── script editor ────────────────────────── */
      #msc-editor-wrap{
        position:relative;
        height:200px;
        background:var(--bg);
        border:1px solid var(--border);
        border-radius:var(--radius);
        overflow:hidden;
      }
      #msc-highlight,#msc-editor{
        position:absolute;inset:0;margin:0;border:0;
        padding:6px 8px;
        font:12px/1.45 var(--font-mono);
        white-space:pre;overflow:auto;
      }
      #msc-highlight{pointer-events:none;color:#ddd}
      #msc-editor{
        resize:none;
        background:transparent;
        color:transparent;
        caret-color:#eee;
      }
      #msc-status{
        margin-top:4px;
        min-height:14px;
        font-size:11px;
        color:var(--text-dim);
      }

      /* ── pixel editor controls ────────────────── */
      #pixel-controls{display:flex;flex-direction:column;gap:5px;margin-bottom:5px}
      .pixel-row{display:flex;align-items:center;gap:5px;flex-wrap:wrap}

      .pixel-row input[type=number]{
        width:52px;padding:2px 4px;
        background:var(--bg);border:1px solid var(--border);
        color:var(--text);border-radius:var(--radius);
        font:inherit;
      }
      .pixel-row input[type=range]{
        height:3px;accent-color:var(--accent);
      }
      .pixel-row input[type=color]{
        width:22px;height:22px;padding:0;border:1px solid var(--border);
        border-radius:var(--radius);background:none;cursor:pointer;
      }
      .pixel-row label{color:var(--text-dim);cursor:pointer;user-select:none}
      #zoom-level,#brush-size-label{min-width:28px;color:var(--text-dim)}

      /* ── palette ──────────────────────────────── */
      #palette-swatches{display:flex;gap:3px;flex-wrap:wrap}
      .palette-swatch{
        width:16px;height:16px;
        border:1px solid var(--border);
        border-radius:2px;
        cursor:pointer;
        transition:border-color 80ms;
      }
      .palette-swatch:hover{border-color:var(--text-dim)}

      /* ── toggle chips (replace checkboxes) ───── */
      .chip-row{display:flex;gap:3px;flex-wrap:wrap}
      .chip-row label{
        display:inline-flex;align-items:center;gap:3px;
        padding:2px 6px;
        background:var(--surface-2);
        border:1px solid var(--border);
        border-radius:var(--radius);
        cursor:pointer;
        transition:background 80ms,border-color 80ms;
        user-select:none;
      }
      .chip-row label:hover{border-color:var(--border-hi)}
      .chip-row input[type=checkbox]{display:none}
      .chip-row input[type=checkbox]:checked+span{color:var(--accent)}
      .chip-row label:has(input:checked){
        background:var(--accent-bg);
        border-color:var(--accent);
      }

      /* ── pixel canvas area ────────────────────── */
      #pixel-editor-wrap{
        width:100%;max-width:400px;
        border:1px solid var(--border);
        border-radius:var(--radius);
        background:
          linear-gradient(45deg,#111 25%,transparent 25%) -4px 0/8px 8px,
          linear-gradient(-45deg,#111 25%,transparent 25%) -4px 0/8px 8px,
          linear-gradient(45deg,transparent 75%,#111 75%) -4px 0/8px 8px,
          linear-gradient(-45deg,transparent 75%,#111 75%) -4px 0/8px 8px,
          #090909;
        overflow:auto;
      }
      #pixel-stage{position:relative;display:inline-block;vertical-align:top}
      #pixel-editor{
        width:64px;height:64px;
        image-rendering:pixelated;
        background:#000;border:0;
      }
      #pixel-grid-overlay{
        position:absolute;inset:0;
        pointer-events:none;image-rendering:pixelated;
      }
      #pixel-footer{
        margin-top:4px;font-size:10px;color:var(--text-dim);
        display:flex;justify-content:space-between;
      }

      /* ── docs pane ────────────────────────────── */
      #docs-pane{
        background:var(--surface);
        border:1px solid var(--border);
        border-radius:var(--radius);
        padding:6px 8px;
        display:none;
        max-height:calc(100vh - 24px);
        overflow:hidden;
      }
      #mozaic-app.docs-open #docs-pane{
        display:flex;flex-direction:column;gap:6px;
      }
      #docs-search{
        width:100%;padding:4px 6px;
        border-radius:var(--radius);
        background:var(--bg);border:1px solid var(--border);
        color:var(--text);font:inherit;
      }
      #docs-search::placeholder{color:var(--text-dim)}
      #docs-results{
        display:flex;flex-direction:column;gap:3px;
        max-height:160px;overflow:auto;
      }
      .doc-item{
        text-align:left;
        background:var(--surface-2);
        border:1px solid var(--border);
        color:var(--text);
        border-radius:var(--radius);
        padding:4px 6px;cursor:pointer;
        transition:border-color 80ms;
        font:inherit;
      }
      .doc-item:hover{border-color:var(--border-hi)}
      .doc-item small{display:block;color:var(--text-dim);margin-top:1px;font-size:10px}
      .doc-item.is-active{border-color:var(--accent);background:var(--accent-bg)}
      #docs-content{
        border:1px solid var(--border);
        border-radius:var(--radius);
        padding:6px 8px;
        background:var(--bg);
        font-size:11px;line-height:1.55;
        color:var(--text);
        overflow:auto;white-space:pre-wrap;
        flex:1;
      }

      /* ── canvas ───────────────────────────────── */
      canvas{display:block;border:1px solid var(--border);image-rendering:pixelated}

      /* ── syntax highlighting ──────────────────── */
      .msc-keyword{color:#56b6c2}
      .msc-string{color:#98c379}
      .msc-comment{color:#6a9955}
      .msc-symbol{color:#e5c07b}

      /* ── responsive ───────────────────────────── */
      @media(max-width:1080px){
        #mozaic-app{display:flex;flex-direction:column;align-items:center}
        #tools-panel{width:min(720px,100%)}
      }

      /* ── scrollbar ────────────────────────────── */
      ::-webkit-scrollbar{width:5px;height:5px}
      ::-webkit-scrollbar-track{background:transparent}
      ::-webkit-scrollbar-thumb{background:#333;border-radius:3px}
      ::-webkit-scrollbar-thumb:hover{background:#444}
    </style>
  </head>
  <body>
    <div id="mozaic-app">
      <canvas id="mozaic-canvas"></canvas>

      <aside id="tools-panel">
        <!-- toolbar -->
        <div class="tool-row">
          <button id="new-rom-button" type="button">New</button>
          <button id="open-rom-button" type="button">Open ROM</button>
          <button id="open-script-button" type="button">Script</button>
          <button id="open-config-button" type="button">Config</button>
          <button id="save-rom-button" type="button">Save</button>
          <button id="reload-config-button" type="button">Reload</button>
          <button id="restart-button" type="button">Restart</button>
          <button id="toggle-docs-button" type="button">Docs</button>
        </div>

        <!-- script editor -->
        <div class="tool-section" id="msc-section">
          <div class="tool-title" id="text-editor-title">Script Editor</div>
          <div id="msc-editor-wrap">
            <pre id="msc-highlight"></pre>
            <textarea id="msc-editor" spellcheck="false" aria-label="MSC editor"></textarea>
          </div>
          <div id="msc-status"></div>
        </div>

        <!-- pixel editor -->
        <div class="tool-section" id="pixel-section">
          <div class="tool-title">Pixel Editor</div>
          <div id="pixel-controls">
            <!-- color + palette -->
            <div class="pixel-row">
              <input id="pixel-color" type="color" value="#ff00ff" />
              <button id="palette-add-button" type="button">+</button>
              <div id="palette-swatches"></div>
            </div>
            <!-- presets & eraser -->
            <div class="pixel-row">
              <button id="preset-pencil-button" type="button">Pencil</button>
              <button id="preset-brush-button" type="button">Brush</button>
              <button id="preset-eraser-button" type="button">Eraser</button>
              <button id="eraser-toggle-button" type="button">E</button>
              <span style="flex:1"></span>
              <button id="undo-button" type="button">↩</button>
              <button id="redo-button" type="button">↪</button>
              <button id="clear-button" type="button">✕</button>
            </div>
            <!-- zoom & brush -->
            <div class="pixel-row">
              <label for="pixel-zoom">Zoom</label>
              <input id="pixel-zoom" type="range" min="2" max="30" value="8" />
              <span id="zoom-level">8×</span>
              <label for="brush-size">Size</label>
              <input id="brush-size" type="range" min="1" max="9" value="1" />
              <span id="brush-size-label">1</span>
            </div>
            <!-- grid & debug chips -->
            <div class="chip-row">
              <label><input id="grid-inline-toggle" type="checkbox" checked /><span>Grid</span></label>
              <label><input id="grid-custom-toggle" type="checkbox" /><span>Custom</span></label>
              <label><input id="debug-collision-toggle" type="checkbox" /><span>Collision</span></label>
              <label><input id="debug-path-toggle" type="checkbox" /><span>Paths</span></label>
              <label><input id="debug-points-toggle" type="checkbox" /><span>Pts</span></label>
              <label><input id="debug-ids-toggle" type="checkbox" /><span>IDs</span></label>
            </div>
            <!-- grid numbers -->
            <div class="pixel-row">
              <label for="grid-size">Cell</label>
              <input id="grid-size" type="number" min="1" max="64" value="8" />
              <label for="grid-major">Major</label>
              <input id="grid-major" type="number" min="1" max="64" value="4" />
            </div>
          </div>
          <div id="pixel-editor-wrap">
            <div id="pixel-stage">
              <canvas id="pixel-editor" width="64" height="64"></canvas>
              <canvas id="pixel-grid-overlay" width="64" height="64"></canvas>
            </div>
          </div>
          <div id="pixel-footer">
            <span>Alt+Click picks layer</span>
            <span id="pixel-coords">–, –</span>
          </div>
        </div>
      </aside>

      <!-- docs -->
      <aside id="docs-pane">
        <div class="tool-title">Docs</div>
        <input id="docs-search" type="text" placeholder="Search…" />
        <div id="docs-results"></div>
        <div id="docs-content">Select a document.</div>
      </aside>
    </div>
    <script type="module" src="/src/index.ts"></script>
  </body>
</html>
